openapi: 3.0.3
info:
  title: Student Roster Management API
  description: |
    API endpoints for managing class rosters - adding, editing, and removing students.
    
    This API supports the "Manage Class Roster" feature (004-manage-class-roster)
    enabling teachers to maintain accurate enrollment records through CRUD operations.
  version: 1.0.0
  contact:
    name: API Support
    email: api@example.com

servers:
  - url: http://localhost:3000/api
    description: Local development server
  - url: https://api.example.com/api
    description: Production server

tags:
  - name: Students
    description: Student roster management operations

paths:
  /classes/{classId}/students:
    get:
      tags:
        - Students
      summary: Get all students in a class roster
      description: |
        Retrieves the list of students enrolled in a specific class.
        Used for displaying the roster table and populating form validation caches.
      operationId: getClassStudents
      parameters:
        - name: classId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique identifier of the class
        - name: status
          in: query
          required: false
          schema:
            type: string
            enum: [active, transferred, graduated, dropped]
          description: Filter students by enrollment status
        - name: search
          in: query
          required: false
          schema:
            type: string
          description: Search students by name or student code
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - name: pageSize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Number of students per page
      responses:
        '200':
          description: Successfully retrieved students
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Student'
                  meta:
                    type: object
                    properties:
                      total:
                        type: integer
                        description: Total number of students in the class
                      page:
                        type: integer
                      pageSize:
                        type: integer
              examples:
                successResponse:
                  value:
                    data:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        studentCode: "STU001"
                        firstName: "John"
                        lastName: "Doe"
                        fullName: "John Doe"
                        email: "john.doe@example.com"
                        phone: "+1234567890"
                        classId: "660e8400-e29b-41d4-a716-446655440000"
                        status: "active"
                        enrollmentDate: "2025-09-01T00:00:00Z"
                        createdAt: "2025-09-01T10:30:00Z"
                        updatedAt: "2025-09-01T10:30:00Z"
                    meta:
                      total: 45
                      page: 1
                      pageSize: 50
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Class not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                classNotFound:
                  value:
                    error: "Not Found"
                    message: "Class with ID 660e8400-e29b-41d4-a716-446655440000 not found"
                    code: "CLASS_NOT_FOUND"

    post:
      tags:
        - Students
      summary: Add a new student to the class roster
      description: |
        Creates a new student enrollment in the specified class.
        Validates required fields and enforces unique student code constraint (FR-004).
        Corresponds to User Story 1 (Priority P1) in the feature specification.
      operationId: createStudent
      parameters:
        - name: classId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique identifier of the class
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StudentCreateRequest'
            examples:
              createStudent:
                value:
                  studentCode: "STU045"
                  firstName: "Jane"
                  lastName: "Smith"
                  email: "jane.smith@example.com"
                  phone: "+1234567891"
                  dateOfBirth: "2010-05-15"
                  gender: "female"
                  parentName: "Mary Smith"
                  parentPhone: "+1234567892"
                  enrollmentDate: "2025-10-30T00:00:00Z"
      responses:
        '201':
          description: Student created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Student'
                  message:
                    type: string
                    example: "Student added successfully"
              examples:
                successResponse:
                  value:
                    data:
                      id: "770e8400-e29b-41d4-a716-446655440000"
                      studentCode: "STU045"
                      firstName: "Jane"
                      lastName: "Smith"
                      fullName: "Jane Smith"
                      email: "jane.smith@example.com"
                      phone: "+1234567891"
                      classId: "660e8400-e29b-41d4-a716-446655440000"
                      status: "active"
                      enrollmentDate: "2025-10-30T00:00:00Z"
                      createdAt: "2025-10-30T14:22:00Z"
                      updatedAt: "2025-10-30T14:22:00Z"
                    message: "Student added successfully"
        '400':
          description: Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                missingFields:
                  value:
                    error: "Bad Request"
                    message: "Validation failed"
                    code: "VALIDATION_ERROR"
                    errors:
                      - field: "firstName"
                        message: "First name is required"
                      - field: "email"
                        message: "Please enter a valid email address"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Duplicate student code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                duplicateStudentCode:
                  value:
                    error: "Conflict"
                    message: "Student code 'STU045' already exists in this class"
                    code: "DUPLICATE_STUDENT_CODE"
                    field: "studentCode"

  /students/{studentId}:
    get:
      tags:
        - Students
      summary: Get student details
      description: Retrieves detailed information about a specific student
      operationId: getStudent
      parameters:
        - name: studentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique identifier of the student
      responses:
        '200':
          description: Successfully retrieved student
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Student'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Student not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                studentNotFound:
                  value:
                    error: "Not Found"
                    message: "Student with ID 550e8400-e29b-41d4-a716-446655440000 not found"
                    code: "STUDENT_NOT_FOUND"

    put:
      tags:
        - Students
      summary: Update student information
      description: |
        Updates an existing student's information.
        Validates required fields and enforces unique student code constraint if studentCode changed.
        Corresponds to User Story 2 (Priority P2) in the feature specification.
      operationId: updateStudent
      parameters:
        - name: studentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique identifier of the student
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StudentUpdateRequest'
            examples:
              updateEmail:
                value:
                  email: "jane.smith.updated@example.com"
                  phone: "+1234567899"
              updateName:
                value:
                  firstName: "Jane"
                  lastName: "Smith-Johnson"
      responses:
        '200':
          description: Student updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Student'
                  message:
                    type: string
                    example: "Student updated successfully"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Student not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Duplicate student code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                duplicateAfterUpdate:
                  value:
                    error: "Conflict"
                    message: "Student code 'STU046' already exists in this class"
                    code: "DUPLICATE_STUDENT_CODE"
                    field: "studentCode"

    delete:
      tags:
        - Students
      summary: Remove student from class roster
      description: |
        Removes a student from the class roster.
        This is a soft delete - student status is set to 'dropped' rather than hard deletion.
        Corresponds to User Story 3 (Priority P3) in the feature specification.
      operationId: deleteStudent
      parameters:
        - name: studentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique identifier of the student
      responses:
        '200':
          description: Student removed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Student removed from roster"
              examples:
                successResponse:
                  value:
                    message: "Student removed from roster"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Student not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Student:
      type: object
      description: Complete student entity with all fields
      required:
        - id
        - studentCode
        - firstName
        - lastName
        - fullName
        - classId
        - status
        - enrollmentDate
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier (generated by backend)
          example: "550e8400-e29b-41d4-a716-446655440000"
        studentCode:
          type: string
          minLength: 1
          maxLength: 50
          description: Unique student identifier within class
          example: "STU001"
        firstName:
          type: string
          minLength: 1
          maxLength: 100
          description: Student's first name
          example: "John"
        lastName:
          type: string
          minLength: 1
          maxLength: 100
          description: Student's last name
          example: "Doe"
        fullName:
          type: string
          description: Computed full name (firstName + lastName)
          readOnly: true
          example: "John Doe"
        dateOfBirth:
          type: string
          format: date
          description: Student's date of birth (ISO 8601)
          example: "2010-03-15"
        gender:
          type: string
          enum: [male, female, other]
          description: Student's gender
          example: "male"
        email:
          type: string
          format: email
          maxLength: 255
          description: Student's email address
          example: "john.doe@example.com"
        phone:
          type: string
          maxLength: 20
          description: Student's phone number
          example: "+1234567890"
        address:
          type: string
          maxLength: 500
          description: Student's residential address
          example: "123 Main St, City, Country"
        parentName:
          type: string
          maxLength: 100
          description: Parent or guardian name
          example: "Jane Doe"
        parentPhone:
          type: string
          maxLength: 20
          description: Parent or guardian phone number
          example: "+1234567891"
        classId:
          type: string
          format: uuid
          description: Reference to the class this student belongs to
          example: "660e8400-e29b-41d4-a716-446655440000"
        enrollmentDate:
          type: string
          format: date-time
          description: Date when student was enrolled (ISO 8601)
          example: "2025-09-01T00:00:00Z"
        status:
          type: string
          enum: [active, transferred, graduated, dropped]
          description: Current enrollment status
          example: "active"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when record was created
          readOnly: true
          example: "2025-09-01T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when record was last updated
          readOnly: true
          example: "2025-10-15T14:20:00Z"

    StudentCreateRequest:
      type: object
      description: Request payload for creating a new student
      required:
        - studentCode
        - firstName
        - lastName
        - email
      properties:
        studentCode:
          type: string
          minLength: 1
          maxLength: 50
          description: Unique student identifier (validated for uniqueness)
          example: "STU045"
        firstName:
          type: string
          minLength: 1
          maxLength: 100
          description: Student's first name
          example: "Jane"
        lastName:
          type: string
          minLength: 1
          maxLength: 100
          description: Student's last name
          example: "Smith"
        email:
          type: string
          format: email
          maxLength: 255
          description: Student's email address (required)
          example: "jane.smith@example.com"
        phone:
          type: string
          maxLength: 20
          description: Student's phone number (optional)
          example: "+1234567891"
        address:
          type: string
          maxLength: 500
          description: Student's residential address (optional)
          example: "456 Oak St, City, Country"
        parentName:
          type: string
          maxLength: 100
          description: Parent or guardian name (optional)
          example: "Mary Smith"
        parentPhone:
          type: string
          maxLength: 20
          description: Parent or guardian phone (optional)
          example: "+1234567892"
        dateOfBirth:
          type: string
          format: date
          description: Student's date of birth (optional)
          example: "2010-05-15"
        gender:
          type: string
          enum: [male, female, other]
          description: Student's gender (optional)
          example: "female"
        enrollmentDate:
          type: string
          format: date-time
          description: Enrollment date (defaults to current date if omitted)
          example: "2025-10-30T00:00:00Z"

    StudentUpdateRequest:
      type: object
      description: Request payload for updating existing student (all fields optional)
      properties:
        studentCode:
          type: string
          minLength: 1
          maxLength: 50
          description: Updated student code (validated for uniqueness if changed)
          example: "STU046"
        firstName:
          type: string
          minLength: 1
          maxLength: 100
          example: "Jane"
        lastName:
          type: string
          minLength: 1
          maxLength: 100
          example: "Smith-Johnson"
        email:
          type: string
          format: email
          maxLength: 255
          example: "jane.updated@example.com"
        phone:
          type: string
          maxLength: 20
          example: "+1234567899"
        address:
          type: string
          maxLength: 500
        parentName:
          type: string
          maxLength: 100
        parentPhone:
          type: string
          maxLength: 20
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
          enum: [male, female, other]
        status:
          type: string
          enum: [active, transferred, graduated, dropped]
          description: Update enrollment status (optional, typically managed separately)

    Error:
      type: object
      description: Standard error response
      required:
        - error
        - message
        - code
      properties:
        error:
          type: string
          description: HTTP status text
          example: "Bad Request"
        message:
          type: string
          description: Human-readable error message
          example: "Validation failed"
        code:
          type: string
          description: Machine-readable error code
          example: "VALIDATION_ERROR"
        field:
          type: string
          description: Field name for field-specific errors (optional)
          example: "studentCode"

    ValidationError:
      type: object
      description: Validation error with field-level details
      required:
        - error
        - message
        - code
        - errors
      properties:
        error:
          type: string
          example: "Bad Request"
        message:
          type: string
          example: "Validation failed"
        code:
          type: string
          example: "VALIDATION_ERROR"
        errors:
          type: array
          items:
            type: object
            required:
              - field
              - message
            properties:
              field:
                type: string
                description: Name of the field that failed validation
                example: "email"
              message:
                type: string
                description: Validation error message
                example: "Please enter a valid email address"

  responses:
    BadRequest:
      description: Invalid request parameters or body
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            validationError:
              value:
                error: "Bad Request"
                message: "Validation failed"
                code: "VALIDATION_ERROR"

    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            unauthorized:
              value:
                error: "Unauthorized"
                message: "Authentication required"
                code: "UNAUTHORIZED"

    Forbidden:
      description: Permission denied (teacher doesn't own this class)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            forbidden:
              value:
                error: "Forbidden"
                message: "You don't have permission to modify this class roster"
                code: "PERMISSION_DENIED"

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token authentication.
        Include the token in the Authorization header: `Authorization: Bearer <token>`

security:
  - BearerAuth: []
